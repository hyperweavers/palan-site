import{a as ne,b as oe,c as ae,d as le,e as se,f as de,g as ce,h as pe,i as me,j as ue}from"./chunk-HVS2ERKD.js";import{a as Q,e as F,g as re}from"./chunk-THK3ACBR.js";import"./chunk-CTBTKHLJ.js";import{a as Z,b as ee,e as te,g as ie}from"./chunk-J6MO7NNG.js";import{a as b}from"./chunk-KRUSALRW.js";import{Db as p,Fb as W,Gb as Y,H as N,Jb as h,K as A,Kb as f,Lb as k,Mb as z,Nb as X,P as O,Pb as L,Qb as R,Ta as c,Ua as w,Za as g,Zb as G,_ as U,aa as E,ab as H,e as B,ea as $,fb as I,ka as q,kc as J,mb as m,nc as K,ob as V,pb as M,qb as P,rb as a,sb as l,ua as u,ub as D,v as C,va as y,vb as T,wb as _}from"./chunk-ZG3MT3EK.js";var S=(()=>{class o{http;constructor(r){this.http=r}getCurrencyList(){return this.http.get(b.api.CURRENCY_LIST).pipe(C(r=>r.map(t=>({code:t.currencyCode,country:t.country,icon:`${b.currency.iconUrl.prefix}${t.countryIconMsid}${b.currency.iconUrl.suffix}`}))))}getForexRates(){return this.http.get(b.api.FOREX).pipe(C(r=>{let t={};if(r.success!==1)console.error("Failed to fetch forex rates!");else{let e=r.data.headers,i=r.data.data;e.forEach((d,n)=>{let v=F[d];v&&(t[v]={},e.forEach((ge,he)=>{let j=F[ge];j&&(t[v][j]=i[n][he])}))})}return t}))}static \u0275fac=function(t){return new(t||o)(q(Q))};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var x=class{static convertYearsMonthsDaysToDays(s,r,t){let e=s||0,i=r||0,d=t||0;return(e+i/12)*365+d}static convertDaysToYearsMonthsDays(s){let r=Math.floor(s/365),t=s%365,e=Math.floor(t/30),i=t%30;return{years:r,months:e,days:i}}};var ye=(o,s)=>s.code,be=(o,s)=>s.vendorCode.mc.primary;function Ce(o,s){if(o&1){let r=D();a(0,"li",25),T("click",function(){let e=u(r).$implicit,i=_(3);return y(i.selectStock(e))}),p(1),l()}if(o&2){let r=s.$implicit;c(),W(" ",r.name," ")}}function _e(o,s){if(o&1&&(a(0,"ul",23),M(1,Ce,2,1,"li",24,be),l()),o&2){let r=_();c(),P(r)}}function xe(o,s){if(o&1&&I(0,_e,3,0,"ul",23),o&2){let r=_();V(r.showSearchResults&&s.length>0?0:-1)}}function we(o,s){if(o&1&&(a(0,"option",18),p(1),l()),o&2){let r,t=s.$implicit,e=_();m("ngValue",t)("selected",t.code===((r=e.purchaseCurrency())==null?null:r.code)),c(),Y(" ",t.country," - ",t.code," ")}}function Me(o,s){if(o&1&&(a(0,"option",18),p(1),l()),o&2){let r,t=s.$implicit,e=_();m("ngValue",t)("selected",t.code===((r=e.contributionCurrency())==null?null:r.code)),c(),Y(" ",t.country," - ",t.code," ")}}var Ge=(()=>{class o{planService;marketService;currencyService;stockSearchResults$;currencyList$;plan;name=g("");lockInPeriodYears=g(0);lockInPeriodMonths=g(0);lockInPeriodDays=g(0);purchaseCurrency=g(null);contributionCurrency=g(null);showSearchResults;isEditMode=!1;selectedStock;constructor(r,t,e){this.planService=r,this.marketService=t,this.currencyService=e,this.stockSearchResults$=Z(this.name).pipe(A(500),O(),E(i=>{this.showSearchResults=!1,i!==this.selectedStock?.name&&(this.selectedStock=void 0)}),N(i=>i.length>2&&i!==this.selectedStock?.name),U(i=>t.search(i).pipe(C(d=>d.filter(n=>n.scripCode.isin&&n.scripCode.ticker&&n.scripCode.country)))),E(()=>{(!this.plan()||this.isEditMode)&&(this.showSearchResults=!0)})),this.currencyList$=e.getCurrencyList().pipe(C(i=>i.filter(d=>b.currency.allowed.includes(d.code)))),this.plan=ee(r.plan$),G(()=>{if(this.plan()){let i=x.convertDaysToYearsMonthsDays(this.plan()?.lockInPeriod||0);this.name.set(this.plan()?.stock?.name||""),this.lockInPeriodYears.set(i.years),this.lockInPeriodMonths.set(i.months),this.lockInPeriodDays.set(i.days),this.purchaseCurrency.set(this.plan()?.currencies?.purchase||null),this.contributionCurrency.set(this.plan()?.currencies?.contribution||null),this.selectedStock=this.plan()?.stock,this.isEditMode=!1}})}selectStock(r){r.scripCode.isin&&r.scripCode.ticker&&r.scripCode.country&&(this.selectedStock=r,this.name.set(r.name)),this.showSearchResults=!1}save(){return B(this,null,function*(){if(!this.plan()||this.isEditMode){if(this.selectedStock&&(this.lockInPeriodYears()>0||this.lockInPeriodMonths()>0||this.lockInPeriodDays()>0)&&this.purchaseCurrency()&&this.contributionCurrency()){let r={id:this.plan()?.id||te(),stock:this.selectedStock,lockInPeriod:x.convertYearsMonthsDaysToDays(this.lockInPeriodYears(),this.lockInPeriodMonths(),this.lockInPeriodDays())||0,currencies:{purchase:this.purchaseCurrency(),contribution:this.contributionCurrency()}};yield this.planService.addOrUpdate(r)}}else this.isEditMode=!0})}static \u0275fac=function(t){return new(t||o)(w(ie),w(re),w(S))};static \u0275cmp=H({type:o,selectors:[["app-plan"]],features:[X([S])],decls:48,vars:22,consts:[[1,"flex","h-full","flex-col","p-4"],[1,"text-xl","font-semibold","text-gray-900","sm:text-2xl","dark:text-white"],[1,"max-w-sm","space-y-4","py-2"],[1,"relative"],["for","name",1,"mb-2","block","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","name","name","id","name","placeholder","Type company name/symbol...","required","","autocomplete","off",1,"focus:ring-primary-600","focus:border-primary-600","dark:focus:ring-primary-500","dark:focus:border-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"absolute","z-10","mt-px","w-full","divide-y","divide-gray-100","rounded-lg","bg-white","shadow","dark:bg-gray-700"],["for","lock-in-peroid",1,"mb-2","block","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"grid","grid-cols-3","gap-2"],[1,"flex","flex-col","items-center","sm:flex-row"],["for","lock-in-peroid-years",1,"mb-2","block","text-xs","font-medium","text-gray-900","sm:mb-0","sm:mr-2","dark:text-white"],["type","number","min","0","id","lock-in-peroid-years","name","lockInPeriodYears","placeholder","Years",1,"focus:border-primary-500","focus:ring-primary-500","dark:focus:border-primary-500","dark:focus:ring-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],["for","lock-in-peroid-months",1,"mb-2","block","text-xs","font-medium","text-gray-900","sm:mb-0","sm:mr-2","dark:text-white"],["type","number","min","0","id","lock-in-peroid-months","name","lockInPeriodMonths","placeholder","Months",1,"focus:border-primary-500","focus:ring-primary-500","dark:focus:border-primary-500","dark:focus:ring-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],["for","lock-in-peroid-days",1,"mb-2","block","text-xs","font-medium","text-gray-900","sm:mb-0","sm:mr-2","dark:text-white"],["type","number","min","0","id","lock-in-peroid-days","name","lockInPeriodDays","placeholder","Days",1,"focus:border-primary-500","focus:ring-primary-500","dark:focus:border-primary-500","dark:focus:ring-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],["for","purchase-currency",1,"mb-2","block","text-sm","font-medium","text-gray-900","dark:text-white"],["id","purchase-currency","name","purchaseCurrency","required","",1,"focus:ring-primary-600","focus:border-primary-600","dark:focus:ring-primary-500","dark:focus:border-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],[3,"ngValue","selected"],["for","contribution-currency",1,"mb-2","block","text-sm","font-medium","text-gray-900","dark:text-white"],["id","contribution-currency","name","contributionCurrency","required","",1,"focus:ring-primary-600","focus:border-primary-600","dark:focus:ring-primary-500","dark:focus:border-primary-500","block","w-full","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:placeholder-gray-400",3,"ngModelChange","ngModel","disabled"],[1,"flex","justify-center","pt-4"],["type","submit",1,"bg-primary-700","hover:bg-primary-800","focus:ring-primary-300","dark:bg-primary-600","dark:hover:bg-primary-700","dark:focus:ring-primary-800","inline-flex","justify-center","rounded-lg","px-5","py-2.5","text-center","text-sm","font-medium","text-white","focus:outline-none","focus:ring-4",3,"click"],[1,"py-2","text-sm","text-gray-700","dark:text-gray-200"],[1,"block","cursor-pointer","px-4","py-2","hover:bg-gray-100","dark:hover:bg-gray-600","dark:hover:text-white"],[1,"block","cursor-pointer","px-4","py-2","hover:bg-gray-100","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"]],template:function(t,e){if(t&1){let i=D();z(0),L(1,"async"),a(2,"div",0)(3,"h1",1),p(4," Plan "),l(),a(5,"div",2)(6,"div",3)(7,"label",4),p(8,"Company"),l(),a(9,"input",5),k("ngModelChange",function(n){return u(i),f(e.name,n)||(e.name=n),y(n)}),l(),a(10,"div",6),I(11,xe,1,1),L(12,"async"),l()(),a(13,"div")(14,"label",7),p(15,"Lock-in Period"),l(),a(16,"div",8)(17,"div",9)(18,"label",10),p(19,"Years"),l(),a(20,"input",11),k("ngModelChange",function(n){return u(i),f(e.lockInPeriodYears,n)||(e.lockInPeriodYears=n),y(n)}),l()(),a(21,"div",9)(22,"label",12),p(23,"Months"),l(),a(24,"input",13),k("ngModelChange",function(n){return u(i),f(e.lockInPeriodMonths,n)||(e.lockInPeriodMonths=n),y(n)}),l()(),a(25,"div",9)(26,"label",14),p(27,"Days"),l(),a(28,"input",15),k("ngModelChange",function(n){return u(i),f(e.lockInPeriodDays,n)||(e.lockInPeriodDays=n),y(n)}),l()()()(),a(29,"div")(30,"label",16),p(31,"Purchase Currency"),l(),a(32,"select",17),k("ngModelChange",function(n){return u(i),f(e.purchaseCurrency,n)||(e.purchaseCurrency=n),y(n)}),a(33,"option",18),p(34," Select "),l(),M(35,we,2,4,"option",18,ye),l()(),a(37,"div")(38,"label",19),p(39,"Contribution Currency"),l(),a(40,"select",20),k("ngModelChange",function(n){return u(i),f(e.contributionCurrency,n)||(e.contributionCurrency=n),y(n)}),a(41,"option",18),p(42," Select "),l(),M(43,Me,2,4,"option",18,ye),l()(),a(45,"div",21)(46,"button",22),T("click",function(){return u(i),y(e.save())}),p(47),l()()()()}if(t&2){let i,d=R(1,18,e.currencyList$);c(9),h("ngModel",e.name),m("disabled",!!e.plan()&&!e.isEditMode),c(2),V((i=R(12,20,e.stockSearchResults$))?11:-1,i),c(9),h("ngModel",e.lockInPeriodYears),m("disabled",!!e.plan()&&!e.isEditMode),c(4),h("ngModel",e.lockInPeriodMonths),m("disabled",!!e.plan()&&!e.isEditMode),c(4),h("ngModel",e.lockInPeriodDays),m("disabled",!!e.plan()&&!e.isEditMode),c(4),h("ngModel",e.purchaseCurrency),m("disabled",!!e.plan()&&!e.isEditMode),c(),m("ngValue",null)("selected",!e.purchaseCurrency()),c(2),P(d),c(5),h("ngModel",e.contributionCurrency),m("disabled",!!e.plan()&&!e.isEditMode),c(),m("ngValue",null)("selected",!e.contributionCurrency()),c(2),P(d),c(4),W(" ",e.plan()&&!e.isEditMode?"Edit":"Save"," ")}},dependencies:[K,J,ue,de,ce,ne,le,se,oe,me,pe,ae],encapsulation:2,changeDetection:0})}return o})();export{Ge as PlanPage};
